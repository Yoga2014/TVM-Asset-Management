<div class="submission-container">

  <div class="header">
    <h2>
      {{ role === 'ADMIN' ? 'All Employee Submission List' : 'My Submission List' }}
    </h2>

    <button mat-raised-button color="primary" class="sort-btn" (click)="toggleSort()">
      Sort by Date
    </button>
  </div>

  <div class="filters">

    <mat-form-field appearance="outline" class="search-box">
      <mat-label>
        {{ role === 'ADMIN' ? 'Search Employee or Asset' : 'Search Asset' }}
      </mat-label>

      <input matInput [(ngModel)]="searchText" (input)="applyFilters()"
        [placeholder]="role === 'ADMIN' ? 'Search Employee or Asset...' : 'Search Asset...'" />

      <button mat-icon-button matSuffix *ngIf="searchText" (click)="clearSearch()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <div class="date-box">
      <label>From Date</label>
      <input type="date" [(ngModel)]="fromDate" (change)="applyFilters()" />
    </div>

    <div class="date-box">
      <label>To Date</label>
      <input type="date" [(ngModel)]="toDate" (change)="applyFilters()" />
    </div>

    <button mat-raised-button class="btn-export" color="primary" (click)="exportToCSV()">
      Export
    </button>

    <button mat-raised-button class="btn-clear" color="warn" (click)="clearFilters()">
      Clear
    </button>

  </div>

  <div class="table-wrapper" *ngIf="paginatedData.length > 0">

    <!-- ================= ADMIN TABLE ================= -->
    <table *ngIf="role === 'ADMIN'" mat-table [dataSource]="paginatedData"
      class="mat-elevation-z2 submission-table">

      <ng-container matColumnDef="employee">
        <th mat-header-cell *matHeaderCellDef> Employee </th>
        <td mat-cell *matCellDef="let row"> {{ row.employeeName }} </td>
      </ng-container>

      <ng-container matColumnDef="asset">
        <th mat-header-cell *matHeaderCellDef> Asset </th>
        <td mat-cell *matCellDef="let row">
          <span class="asset-chip">{{ row.assetName }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Submitted Date </th>
        <td mat-cell *matCellDef="let row">
          {{ row.submittedDate | date:'dd-MMM-yyyy' }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>


    <!-- ================= EMPLOYEE TABLE ================= -->
    <table *ngIf="role === 'EMPLOYEE'" mat-table [dataSource]="paginatedData"
      class="mat-elevation-z2 submission-table">

      <ng-container matColumnDef="asset">
        <th mat-header-cell *matHeaderCellDef> Asset </th>
        <td mat-cell *matCellDef="let row">
          <span class="asset-chip">{{ row.assetName }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Submitted Date </th>
        <td mat-cell *matCellDef="let row">
          {{ row.submittedDate | date:'dd-MMM-yyyy' }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['asset','date']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['asset','date'];"></tr>

    </table>

  </div>

  <div class="no-data" *ngIf="paginatedData.length === 0">
    <p>No submissions found.</p>
  </div>

  <div class="pagination" *ngIf="filteredSubmissions.length > 0">

    <button mat-raised-button color="primary"
      (click)="prevPage()" [disabled]="currentPage === 1">
      Prev
    </button>

    <span>Page {{ currentPage }} of {{ totalPages }}</span>

    <button mat-raised-button color="primary"
      (click)="nextPage()" [disabled]="currentPage === totalPages">
      Next
    </button>

  </div>

</div>
